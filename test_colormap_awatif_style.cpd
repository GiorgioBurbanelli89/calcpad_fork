"Color Map FEM - Estilo Awatif
'Replica el patron modular de awatif-ui/color-map

"1. Datos FEM
nodos = 4
elementos = 2

"========================================
"2. styles.css
"========================================
@{css}
#legend {
  width: 20px;
  height: 50vh;
  background: linear-gradient(#ff0000, #ffff00 20%, #00ff00 50%, #00ffff 80%, #0000ff);
  position: absolute;
  right: 100px;
  bottom: 25vh;
  z-index: 2;
}

#legend .marker {
  width: 10px;
  height: 1px;
  margin-left: 20px;
  background: white;
  position: relative;
}

#legend .marker p {
  position: absolute;
  color: white;
  font-size: 14px;
  top: -7px;
  left: 15px;
  margin: 0px;
  font-family: "Courier New";
  font-weight: 500;
}
@{end css}

"========================================
"3. index.html (minimo, como awatif)
"========================================
@{html:embed}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Awatif UI - Color Map</title>
</head>
<body>
    <script type="module">
        // main.ts - importa y ejecuta todo
        import * as THREE from 'https://unpkg.com/three@0.160.0/build/three.module.js';
        import { OrbitControls } from 'https://unpkg.com/three@0.160.0/examples/jsm/controls/OrbitControls.js';
        import { Lut } from 'https://unpkg.com/three@0.160.0/examples/jsm/math/Lut.js';

        // ============ getColorMap.ts ============
        function getColorMap(nodes, elements, values) {
            const lut = new Lut('rainbow', 512);
            lut.setMin(Math.min(...values));
            lut.setMax(Math.max(...values));

            const geometry = new THREE.BufferGeometry();
            geometry.setAttribute('position', new THREE.Float32BufferAttribute(nodes.flat(), 3));
            geometry.setIndex(new THREE.Uint16BufferAttribute(elements.filter(e => e.length !== 2).flat(), 1));

            const colors = new Float32Array(nodes.length * 3);
            for (let i = 0; i < values.length; i++) {
                const c = lut.getColor(values[i]) || new THREE.Color(0, 0, 0);
                colors[i * 3] = c.r * 0.6;
                colors[i * 3 + 1] = c.g * 0.6;
                colors[i * 3 + 2] = c.b * 0.6;
            }
            geometry.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3));

            return new THREE.Mesh(geometry, new THREE.MeshBasicMaterial({ vertexColors: true, side: THREE.DoubleSide }));
        }

        // ============ getLegend.ts ============
        function getLegend(values, numMarkerIntervals = 8) {
            const legendElm = document.createElement('div');
            legendElm.id = 'legend';
            legendElm.style.cssText = 'width:20px;height:200px;background:linear-gradient(#ff0000,#ffff00 20%,#00ff00 50%,#00ffff 80%,#0000ff);position:absolute;right:50px;top:90px;z-index:2';

            const minVal = Math.min(...values);
            const maxVal = Math.max(...values);

            for (let i = 0; i <= numMarkerIntervals; i++) {
                const ratio = i / numMarkerIntervals;
                const value = (maxVal - (maxVal - minVal) * ratio).toPrecision(3);
                const marker = document.createElement('div');
                marker.style.cssText = `width:10px;height:1px;margin-left:20px;background:white;position:relative;margin-top:${i === 0 ? 0 : (200 / numMarkerIntervals) - 1}px`;
                const p = document.createElement('p');
                p.style.cssText = 'position:absolute;color:white;font-size:11px;top:-6px;left:12px;margin:0;font-family:monospace';
                p.textContent = value;
                marker.appendChild(p);
                legendElm.appendChild(marker);
            }
            return legendElm;
        }

        // ============ getViewer.ts (simplificado) ============
        function getViewer(mesh, objects3D) {
            const container = document.createElement('div');
            container.style.cssText = 'width:100%;height:380px';

            const scene = new THREE.Scene();
            scene.background = new THREE.Color(0x1a1a2e);

            const camera = new THREE.PerspectiveCamera(45, 800 / 380, 0.1, 1000);
            camera.position.set(10, -12, 8);
            camera.up.set(0, 0, 1);

            const renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(800, 380);
            container.appendChild(renderer.domElement);

            const controls = new OrbitControls(camera, renderer.domElement);
            controls.target.set(2.5, 0, 2.5);
            controls.update();

            // Add objects
            objects3D.forEach(obj => scene.add(obj));

            // Wireframe
            if (mesh.nodes) {
                const geom = new THREE.BufferGeometry();
                geom.setAttribute('position', new THREE.Float32BufferAttribute(mesh.nodes.flat(), 3));
                geom.setIndex(new THREE.Uint16BufferAttribute(mesh.elements.flat(), 1));
                scene.add(new THREE.LineSegments(new THREE.WireframeGeometry(geom), new THREE.LineBasicMaterial({ color: 0xffffff })));
            }

            // Grid & Axes
            const grid = new THREE.GridHelper(10, 10, 0x444444, 0x333333);
            grid.rotation.x = Math.PI / 2;
            scene.add(grid);
            scene.add(new THREE.AxesHelper(2));

            function animate() {
                requestAnimationFrame(animate);
                controls.update();
                renderer.render(scene, camera);
            }
            animate();

            return container;
        }

        // ============ main.ts ============
        const nodes = [[0, 0, 0], [5, 0, 0], [5, 0, 5], [0, 0, 5]];
        const elements = [[0, 1, 2], [0, 2, 3]];
        const values = [0, 2.5, 10, 5];

        const colorMap = getColorMap(nodes, elements, values);
        const legend = getLegend(values);
        const viewer = getViewer({ nodes, elements }, [colorMap]);

        document.body.style.margin = '0';
        document.body.style.background = '#1a1a2e';
        document.body.appendChild(legend);
        document.body.appendChild(viewer);
    </script>
</body>
</html>
@{end html:embed}

'Estructura identica a awatif-ui/color-map
