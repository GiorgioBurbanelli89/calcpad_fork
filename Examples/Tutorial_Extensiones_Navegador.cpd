"====================================================================
"üìö TUTORIAL: C√ìMO HACER EXTENSIONES DE NAVEGADOR
"====================================================================
"Por: Claude Code
"Fecha: Enero 2026
"Nivel: Principiante ‚Üí Intermedio

'üéØ OBJETIVO
'Aprender a crear extensiones de navegador que detecten y descarguen videos

"====================================================================
"PARTE 1: ¬øQU√â ES UNA EXTENSI√ìN DE NAVEGADOR?
"====================================================================

'Una extensi√≥n de navegador es un programa peque√±o que:
'  ‚Ä¢ Se ejecuta dentro del navegador (Edge, Chrome, Firefox)
'  ‚Ä¢ Puede modificar p√°ginas web
'  ‚Ä¢ Puede interceptar peticiones HTTP
'  ‚Ä¢ Agrega funcionalidades nuevas

'EJEMPLOS DE EXTENSIONES:
'  ‚úì Video DownloadHelper - Descarga videos
'  ‚úì Grammarly - Corrector de escritura
'  ‚úì AdBlock - Bloquea anuncios
'  ‚úì LastPass - Gestor de contrase√±as

"====================================================================
"PARTE 2: ESTRUCTURA DE UNA EXTENSI√ìN
"====================================================================

'Toda extensi√≥n tiene esta estructura de carpetas:

'Mi-Extension/
'‚îú‚îÄ‚îÄ manifest.json          ‚Üê Archivo de configuraci√≥n (OBLIGATORIO)
'‚îú‚îÄ‚îÄ background.js          ‚Üê C√≥digo de fondo (service worker)
'‚îú‚îÄ‚îÄ content.js             ‚Üê C√≥digo inyectado en p√°ginas
'‚îú‚îÄ‚îÄ popup.html             ‚Üê Interfaz del usuario
'‚îú‚îÄ‚îÄ popup.js               ‚Üê L√≥gica de la interfaz
'‚îú‚îÄ‚îÄ styles.css             ‚Üê Estilos visuales
'‚îî‚îÄ‚îÄ icons/                 ‚Üê Iconos de la extensi√≥n
'    ‚îú‚îÄ‚îÄ icon16.png
'    ‚îú‚îÄ‚îÄ icon48.png
'    ‚îî‚îÄ‚îÄ icon128.png

"--------------------------------------------------------------------
"2.1 - manifest.json (El cerebro de la extensi√≥n)
"--------------------------------------------------------------------

'Es un archivo JSON que define:
'  ‚Ä¢ Nombre y versi√≥n de la extensi√≥n
'  ‚Ä¢ Permisos que necesita
'  ‚Ä¢ Qu√© scripts ejecutar
'  ‚Ä¢ Iconos a usar

'EJEMPLO B√ÅSICO:

'{
'  "manifest_version": 3,
'  "name": "Mi Primera Extensi√≥n",
'  "version": "1.0.0",
'  "description": "Detecta videos en p√°ginas web",
'
'  "permissions": [
'    "activeTab",      ‚Üê Acceder a pesta√±a actual
'    "storage",        ‚Üê Guardar datos localmente
'    "webRequest"      ‚Üê Interceptar peticiones HTTP
'  ],
'
'  "host_permissions": [
'    "<all_urls>"      ‚Üê Acceso a todos los sitios
'  ],
'
'  "action": {
'    "default_popup": "popup.html"   ‚Üê UI al hacer clic
'  },
'
'  "background": {
'    "service_worker": "background.js"  ‚Üê C√≥digo de fondo
'  },
'
'  "content_scripts": [{
'    "matches": ["<all_urls>"],        ‚Üê En qu√© sitios
'    "js": ["content.js"]               ‚Üê Qu√© ejecutar
'  }]
'}

"--------------------------------------------------------------------
"2.2 - background.js (El motor de fondo)
"--------------------------------------------------------------------

'Se ejecuta en segundo plano TODO EL TIEMPO
'Funciones t√≠picas:
'  ‚Ä¢ Interceptar peticiones HTTP
'  ‚Ä¢ Guardar datos
'  ‚Ä¢ Comunicarse con content scripts
'  ‚Ä¢ Procesar tareas pesadas

'EJEMPLO - Interceptar peticiones HTTP:

'chrome.webRequest.onBeforeRequest.addListener(
'  function(details) {
'    const url = details.url;
'
'    // ¬øEs un video?
'    if (url.includes('.mp4') || url.includes('.webm')) {
'      console.log("Video detectado:", url);
'      // Guardar la URL
'      saveVideoUrl(url);
'    }
'  },
'  { urls: ["<all_urls>"] }
');

"--------------------------------------------------------------------
"2.3 - content.js (El esp√≠a de p√°ginas)
"--------------------------------------------------------------------

'Se INYECTA en cada p√°gina web que visitas
'Puede:
'  ‚Ä¢ Leer el HTML de la p√°gina
'  ‚Ä¢ Modificar elementos
'  ‚Ä¢ Detectar elementos <video>
'  ‚Ä¢ Interceptar JavaScript

'EJEMPLO - Buscar videos en el DOM:

'// Buscar todos los elementos <video>
'const videos = document.querySelectorAll('video');
'
'videos.forEach(video => {
'  const src = video.src;
'  console.log("Video encontrado:", src);
'
'  // Enviar al background
'  chrome.runtime.sendMessage({
'    action: 'video-detected',
'    url: src
'  });
'});

"--------------------------------------------------------------------
"2.4 - popup.html + popup.js (La interfaz)
"--------------------------------------------------------------------

'Es la ventana que aparece al hacer clic en el icono
'Contiene botones, listas, configuraci√≥n, etc.

'EJEMPLO - popup.html:

'<!DOCTYPE html>
'<html>
'<body>
'  <h1>Videos Detectados</h1>
'  <div id="video-list"></div>
'  <button onclick="downloadAll()">Descargar Todos</button>
'  <script src="popup.js"></script>
'</body>
'</html>

"====================================================================
"PARTE 3: C√ìMO DETECTAR VIDEOS EN CUALQUIER WEB
"====================================================================

'Hay 4 t√©cnicas principales:

"--------------------------------------------------------------------
"T√âCNICA 1: Interceptar peticiones HTTP (La m√°s potente)
"--------------------------------------------------------------------

'USO: webRequest API
'DETECTA: Archivos .mp4, .webm, .m3u8, .mpd, etc.

'VENTAJAS:
'  ‚úì Detecta TODO el tr√°fico HTTP
'  ‚úì Funciona con videos ocultos
'  ‚úì No depende del HTML

'DESVENTAJAS:
'  ‚úó Requiere permiso <all_urls>
'  ‚úó Puede ser bloqueado por CORS

'C√ìDIGO:
'chrome.webRequest.onBeforeRequest.addListener(
'  function(details) {
'    const url = details.url;
'
'    // Lista de extensiones de video
'    const videoExtensions = [
'      '.mp4', '.webm', '.m4v', '.avi',
'      '.mov', '.flv', '.wmv', '.mkv',
'      '.m3u8', '.mpd', '.ts'
'    ];
'
'    // ¬øContiene alguna extensi√≥n de video?
'    const isVideo = videoExtensions.some(ext =>
'      url.toLowerCase().includes(ext)
'    );
'
'    if (isVideo) {
'      // ¬°Video detectado!
'      storeVideo(url);
'    }
'  },
'  { urls: ["<all_urls>"] }
');

'EJEMPLO REAL:
'Usuario visita: https://example.com/watch
'Browser solicita: https://cdn.example.com/video.mp4
'                              ‚Üì
'webRequest lo intercepta: "¬°.mp4 detectado!"
'                              ‚Üì
'Guarda URL y muestra en popup

"--------------------------------------------------------------------
"T√âCNICA 2: Buscar elementos <video> en el DOM
"--------------------------------------------------------------------

'USO: document.querySelectorAll()
'DETECTA: Tags HTML <video>

'VENTAJAS:
'  ‚úì Simple de implementar
'  ‚úì Funciona en HTML est√°ndar

'DESVENTAJAS:
'  ‚úó No detecta streams ocultos
'  ‚úó No funciona con videos din√°micos

'C√ìDIGO:
'// Buscar todos los <video>
'const videos = document.querySelectorAll('video');
'
'videos.forEach(video => {
'  let src = video.src;
'
'  // Si no tiene src, buscar en <source>
'  if (!src) {
'    const source = video.querySelector('source');
'    if (source) src = source.src;
'  }
'
'  if (src) {
'    console.log("Video HTML5 detectado:", src);
'  }
'});

'EJEMPLO REAL:
'<video controls>
'  <source src="movie.mp4" type="video/mp4">
'  <source src="movie.webm" type="video/webm">
'</video>
'                ‚Üì
'querySelectorAll detecta el <video>
'                ‚Üì
'Extrae src="movie.mp4"

"--------------------------------------------------------------------
"T√âCNICA 3: Detectar streams HLS y DASH
"--------------------------------------------------------------------

'HLS (HTTP Live Streaming):
'  ‚Ä¢ Formato: .m3u8
'  ‚Ä¢ Usado por: Apple, Twitch, sitios de streaming
'  ‚Ä¢ Contiene: Playlist con fragmentos .ts

'DASH (Dynamic Adaptive Streaming):
'  ‚Ä¢ Formato: .mpd
'  ‚Ä¢ Usado por: YouTube, Netflix
'  ‚Ä¢ Contiene: Manifest XML con segmentos

'C√ìDIGO - Detectar HLS:
'chrome.webRequest.onBeforeRequest.addListener(
'  function(details) {
'    if (details.url.includes('.m3u8')) {
'      console.log("HLS stream detectado!");
'
'      // Descargar la playlist
'      fetch(details.url)
'        .then(r => r.text())
'        .then(playlist => {
'          // Parsear segmentos
'          const segments = parseM3U8(playlist);
'          console.log("Segmentos:", segments);
'        });
'    }
'  },
'  { urls: ["<all_urls>"] }
');
'
'function parseM3U8(content) {
'  const lines = content.split('\n');
'  const segments = [];
'
'  lines.forEach(line => {
'    // URLs no empiezan con #
'    if (!line.startsWith('#') && line.trim()) {
'      segments.push(line.trim());
'    }
'  });
'
'  return segments;
'}

'EJEMPLO - Archivo .m3u8:
'#EXTM3U
'#EXT-X-VERSION:3
'#EXTINF:10.0,
'segment0.ts
'#EXTINF:10.0,
'segment1.ts
'#EXTINF:10.0,
'segment2.ts

"--------------------------------------------------------------------
"T√âCNICA 4: Scripts espec√≠ficos por sitio
"--------------------------------------------------------------------

'Algunos sitios (YouTube, Facebook) necesitan c√≥digo especial

'EJEMPLO - YouTube:
'// YouTube guarda datos en window.ytInitialPlayerResponse
'const playerData = window.ytInitialPlayerResponse;
'
'if (playerData) {
'  const formats = playerData.streamingData?.formats || [];
'
'  formats.forEach(format => {
'    console.log("YouTube video:");
'    console.log("  URL:", format.url);
'    console.log("  Quality:", format.qualityLabel);
'    console.log("  Type:", format.mimeType);
'  });
'}

"====================================================================
"PARTE 4: C√ìMO FUNCIONAN JUNTAS LAS 4 T√âCNICAS
"====================================================================

'ESCENARIO: Usuario visita https://example.com/video

'PASO 1: background.js intercepta peticiones HTTP
'  ‚Üí Detecta: video.mp4, stream.m3u8
'  ‚Üí Guarda URLs

'PASO 2: content.js busca en el DOM
'  ‚Üí Encuentra: <video src="...">
'  ‚Üí Notifica al background

'PASO 3: Si detecta .m3u8, parsea playlist
'  ‚Üí Descarga archivo .m3u8
'  ‚Üí Extrae URLs de fragmentos .ts

'PASO 4: Si es YouTube, usa script espec√≠fico
'  ‚Üí Lee window.ytInitialPlayerResponse
'  ‚Üí Extrae todos los formatos disponibles

'RESULTADO: Lista completa de videos en la p√°gina

"====================================================================
"PARTE 5: EJEMPLO COMPLETO - DETECTOR DE VIDEOS
"====================================================================

'Vamos a crear una extensi√≥n que detecte y descargue videos

"--------------------------------------------------------------------
"Archivo: manifest.json
"--------------------------------------------------------------------

'{
'  "manifest_version": 3,
'  "name": "Video Detector Pro",
'  "version": "1.0.0",
'  "description": "Detecta y descarga videos de cualquier sitio",
'
'  "permissions": [
'    "webRequest",
'    "downloads",
'    "storage",
'    "notifications"
'  ],
'
'  "host_permissions": ["<all_urls>"],
'
'  "background": {
'    "service_worker": "background.js"
'  },
'
'  "content_scripts": [{
'    "matches": ["<all_urls>"],
'    "js": ["content.js"]
'  }],
'
'  "action": {
'    "default_popup": "popup.html"
'  }
'}

"--------------------------------------------------------------------
"Archivo: background.js
"--------------------------------------------------------------------

'let detectedVideos = {};
'
'// Interceptar peticiones
'chrome.webRequest.onBeforeRequest.addListener(
'  function(details) {
'    const url = details.url;
'    const tabId = details.tabId;
'
'    // Extensiones de video
'    const videoExts = ['.mp4', '.webm', '.m3u8'];
'
'    // ¬øEs video?
'    const isVideo = videoExts.some(ext => url.includes(ext));
'
'    if (isVideo) {
'      // Guardar por pesta√±a
'      if (!detectedVideos[tabId]) {
'        detectedVideos[tabId] = [];
'      }
'
'      detectedVideos[tabId].push({
'        url: url,
'        timestamp: Date.now()
'      });
'
'      // Actualizar badge
'      chrome.action.setBadgeText({
'        tabId: tabId,
'        text: detectedVideos[tabId].length.toString()
'      });
'    }
'  },
'  { urls: ["<all_urls>"] }
');
'
'// Escuchar mensajes del popup
'chrome.runtime.onMessage.addListener((msg, sender, sendResponse) => {
'  if (msg.action === 'getVideos') {
'    sendResponse({ videos: detectedVideos[msg.tabId] || [] });
'  }
'
'  if (msg.action === 'download') {
'    chrome.downloads.download({
'      url: msg.url,
'      filename: 'video_' + Date.now() + '.mp4'
'    });
'  }
'});

"--------------------------------------------------------------------
"Archivo: content.js
"--------------------------------------------------------------------

'// Buscar videos en el DOM
'function detectVideos() {
'  const videos = document.querySelectorAll('video');
'
'  videos.forEach(video => {
'    const src = video.src || video.querySelector('source')?.src;
'
'    if (src) {
'      chrome.runtime.sendMessage({
'        action: 'video-from-dom',
'        url: src
'      });
'    }
'  });
'}
'
'// Ejecutar al cargar
'detectVideos();
'
'// Observar nuevos videos
'new MutationObserver(() => detectVideos())
'  .observe(document.body, { childList: true, subtree: true });

"--------------------------------------------------------------------
"Archivo: popup.html
"--------------------------------------------------------------------

'<!DOCTYPE html>
'<html>
'<head>
'  <title>Videos Detectados</title>
'</head>
'<body>
'  <h1>Videos Detectados</h1>
'  <div id="video-list"></div>
'  <script src="popup.js"></script>
'</body>
'</html>

"--------------------------------------------------------------------
"Archivo: popup.js
"--------------------------------------------------------------------

'async function loadVideos() {
'  const [tab] = await chrome.tabs.query({
'    active: true,
'    currentWindow: true
'  });
'
'  const response = await chrome.runtime.sendMessage({
'    action: 'getVideos',
'    tabId: tab.id
'  });
'
'  const videoList = document.getElementById('video-list');
'  videoList.innerHTML = '';
'
'  response.videos.forEach(video => {
'    const div = document.createElement('div');
'    div.innerHTML = `
'      <p>${video.url}</p>
'      <button onclick="download('${video.url}')">Descargar</button>
'    `;
'    videoList.appendChild(div);
'  });
'}
'
'function download(url) {
'  chrome.runtime.sendMessage({
'    action: 'download',
'    url: url
'  });
'}
'
'loadVideos();

"====================================================================
"PARTE 6: CONCEPTOS CLAVE EXPLICADOS
"====================================================================

"--------------------------------------------------------------------
"6.1 - ¬øQu√© es webRequest?
"--------------------------------------------------------------------

'Es una API que permite INTERCEPTAR peticiones HTTP

'ANALOG√çA:
'  El navegador es como un cartero
'  webRequest es como revisar cada carta antes de entregarla
'  Puedes ver: destino, contenido, tama√±o

'USO:
'chrome.webRequest.onBeforeRequest.addListener(
'  callback,                    ‚Üê Funci√≥n a ejecutar
'  { urls: ["<all_urls>"] },    ‚Üê En qu√© URLs
'  ["requestBody"]              ‚Üê Qu√© info quieres
');

"--------------------------------------------------------------------
"6.2 - ¬øQu√© es un Content Script?
"--------------------------------------------------------------------

'Es JavaScript que se INYECTA en p√°ginas web

'ANALOG√çA:
'  La p√°gina web es una casa
'  Content script es un inspector que entra a revisar
'  Puede ver muebles (elementos HTML), leer documentos, etc.

'LIMITACIONES:
'  ‚úó No puede acceder a variables JavaScript de la p√°gina
'  ‚úó Corre en contexto aislado
'  ‚úì Puede leer/modificar HTML
'  ‚úì Puede interceptar eventos

"--------------------------------------------------------------------
"6.3 - ¬øQu√© es un Service Worker?
"--------------------------------------------------------------------

'Es c√≥digo que corre en SEGUNDO PLANO

'ANALOG√çA:
'  Es como un mayordomo que trabaja 24/7
'  No tiene interfaz visual
'  Procesa tareas mientras t√∫ navegas

'USOS:
'  ‚Ä¢ Interceptar peticiones HTTP
'  ‚Ä¢ Guardar datos
'  ‚Ä¢ Enviar notificaciones
'  ‚Ä¢ Procesar en segundo plano

"--------------------------------------------------------------------
"6.4 - HLS vs DASH vs MP4
"--------------------------------------------------------------------

'MP4:
'  ‚Ä¢ Archivo √∫nico
'  ‚Ä¢ Descarga progresiva
'  ‚Ä¢ F√°cil de descargar

'HLS (.m3u8):
'  ‚Ä¢ Playlist con fragmentos .ts
'  ‚Ä¢ Streaming adaptativo
'  ‚Ä¢ Requiere FFmpeg para descargar

'DASH (.mpd):
'  ‚Ä¢ Manifest XML
'  ‚Ä¢ Usado por YouTube, Netflix
'  ‚Ä¢ Requiere youtube-dl/yt-dlp

"====================================================================
"PARTE 7: C√ìMO INSTALAR TU EXTENSI√ìN
"====================================================================

'PASOS:

'1. Crea una carpeta con todos los archivos
'   Mi-Extension/
'   ‚îú‚îÄ‚îÄ manifest.json
'   ‚îú‚îÄ‚îÄ background.js
'   ‚îú‚îÄ‚îÄ content.js
'   ‚îú‚îÄ‚îÄ popup.html
'   ‚îî‚îÄ‚îÄ popup.js

'2. Abre Microsoft Edge

'3. Ve a: edge://extensions/

'4. Activa "Modo de desarrollador"

'5. Clic en "Cargar extensi√≥n desempaquetada"

'6. Selecciona tu carpeta

'7. ¬°Listo! Ver√°s tu extensi√≥n instalada

"====================================================================
"PARTE 8: EJERCICIOS PR√ÅCTICOS
"====================================================================

'EJERCICIO 1: Detector b√°sico
'  ‚Üí Crea una extensi√≥n que cuente cu√°ntos <img> hay en una p√°gina
'  ‚Üí Muestra el n√∫mero en el badge del icono

'EJERCICIO 2: Descargador de im√°genes
'  ‚Üí Detecta todas las im√°genes de una p√°gina
'  ‚Üí Permite descargarlas con un clic

'EJERCICIO 3: Bloqueador de anuncios simple
'  ‚Üí Intercepta peticiones a dominios de anuncios
'  ‚Üí Bloqu√©alas usando webRequest

'EJERCICIO 4: Detector de videos completo
'  ‚Üí Combina las 4 t√©cnicas
'  ‚Üí Detecta videos de YouTube, Vimeo y sitios gen√©ricos
'  ‚Üí Permite descargar en HD

"====================================================================
"PARTE 9: RECURSOS PARA APRENDER M√ÅS
"====================================================================

'DOCUMENTACI√ìN OFICIAL:
'  ‚Ä¢ Chrome Extensions: https://developer.chrome.com/docs/extensions/
'  ‚Ä¢ MDN Web Extensions: https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions

'TUTORIALES:
'  ‚Ä¢ Getting Started Guide (oficial de Google)
'  ‚Ä¢ Extension Development Course (YouTube)

'HERRAMIENTAS:
'  ‚Ä¢ FFmpeg - Para procesar streams HLS/DASH
'  ‚Ä¢ yt-dlp - Para descargar de YouTube
'  ‚Ä¢ Postman - Para probar APIs

"====================================================================
"RESUMEN FINAL
"====================================================================

'ESTRUCTURA DE UNA EXTENSI√ìN:
'  manifest.json    ‚Üí Configuraci√≥n
'  background.js    ‚Üí Motor de fondo
'  content.js       ‚Üí Esp√≠a de p√°ginas
'  popup.html       ‚Üí Interfaz

'T√âCNICAS DE DETECCI√ìN:
'  1. webRequest    ‚Üí Interceptar HTTP
'  2. DOM parsing   ‚Üí Buscar <video>
'  3. HLS/DASH      ‚Üí Parsear playlists
'  4. Site-specific ‚Üí YouTube, etc.

'PERMISOS IMPORTANTES:
'  webRequest       ‚Üí Ver peticiones HTTP
'  <all_urls>       ‚Üí Acceso a todos los sitios
'  downloads        ‚Üí Descargar archivos
'  storage          ‚Üí Guardar datos

'FLUJO T√çPICO:
'  1. Usuario visita una p√°gina
'  2. background.js intercepta peticiones
'  3. content.js busca en el DOM
'  4. Se combinan resultados
'  5. popup.html muestra lista
'  6. Usuario descarga video

"====================================================================

'¬°Felicidades! Ahora entiendes c√≥mo funcionan las extensiones de navegador.

'PR√ìXIMOS PASOS:
'  ‚Üí Crea tu primera extensi√≥n
'  ‚Üí Experimenta con webRequest
'  ‚Üí Combina las 4 t√©cnicas de detecci√≥n
'  ‚Üí Comparte tu extensi√≥n

'¬øDUDAS?
'  Revisa la documentaci√≥n oficial
'  Experimenta con el c√≥digo
'  Lee el c√≥digo de extensiones open source

"¬°Mucha suerte en tu viaje creando extensiones! üöÄ
